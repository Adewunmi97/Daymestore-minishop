<h2>Pay with PayPal</h2>

<!-- Replace with dynamic price from Rails -->
<p>Amount to Pay: $10.00</p>

<!-- Include the PayPal SDK -->
<script src="https://www.paypal.com/sdk/js?client-id=ARfuISEGCcURsk4_M-3SHtA1ixslfGMDx3vuq-96DR5ya7QJyWgS5NhyEw741lRwOz3caxoAHeYf9YCm&currency=USD"></script>

<div id="paypal-button-container %>"></div>

<script>
document.addEventListener("turbo:load", function () {
    if (typeof paypal === "undefined") {
      console.error("PayPal SDK failed to load.");
      return;
    }
  paypal.Buttons({
    createOrder: function(data, actions) {
      return actions.order.create({
        purchase_units: [{
          amount: {
            value: '<%= product.price %>'
          }
        }]
      });
    },
    onApprove: function(data, actions) {
      return actions.order.capture().then(function(details) {
        alert('Transaction completed by ' + details.payer.name.given_name);

        // Send transaction to backend
        fetch("/payments/paypal", {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
            "X-CSRF-Token": document.querySelector("[name='csrf-token']").content
          },
          body: JSON.stringify(details)
        }).then(response => {
          if (response.ok) {
            window.location.href = "/payments/thank_you";
          }
        });
      });
    }
  }).render('#paypal-button-container');
</script>
