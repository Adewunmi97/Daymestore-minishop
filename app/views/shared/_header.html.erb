<nav class="sticky bg-white border-b border-gray-200 top-0 z-20" data-controller="toggle">
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
    <div class="flex flex-col lg:flex-row lg:justify-between lg:items-center py-2 space-y-2 lg:space-y-0">

      <!-- Logo and Hamburger -->
      <div class="flex justify-between items-center">
        <%= link_to "DaymeStore", root_path, class: "text-2xl font-bold text-dark" %>

        <!-- Mobile Hamburger -->
        <div class="flex lg:hidden">
          <button type="button"
                  class="inline-flex items-center justify-center p-2 rounded-md text-primary hover:text-gray-900 hover:bg-gray-100 focus:outline-none focus:ring-2 focus:ring-inset focus:ring-dark"
                  aria-controls="mobile-menu"
                  aria-expanded="false"
                  data-action="click->toggle#menu">
            
            <!-- Hamburger Icon -->
            <svg data-toggle-target="openIcon" class="h-6 w-6" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"/>
            </svg>

            <!-- Close (X) Icon -->
            <svg data-toggle-target="closeIcon" class="h-6 w-6 hidden" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
            </svg>
          </button>
        </div>
      </div>

      <!-- Search bar  -->
      <div class="w-full lg:flex-1 lg:px-4 mt-2 lg:mt-0">
        <%= form_with url: products_path, method: :get, local: true, class: "flex w-full" do |form| %>
          <%= form.text_field :query, value: params[:query], placeholder: "Search products...",
            class: "w-full rounded-l-md border border-gray-300 px-4 py-2 focus:ring-2 focus:ring-blue-500 focus:border-blue-500" %>
          <%= form.submit "Search",
            class: "bg-stone-600 text-white px-4 rounded-r-md hover:bg-stone-700" %>
        <% end %>
      </div>

      <!-- Desktop Actions -->
      <div class="hidden lg:flex items-center space-x-4">
        <% if user_signed_in? %>
          <!-- User Photo -->
          <%= render partial: "shared/user_photo", locals: { user: current_user } %>

          <!-- Cart with count -->
          <div class="relative">
            <%= link_to cart_path, class:"relative" do %>
              <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 20 20" stroke-width="1.5" stroke="currentColor" class="w-6 text-primary">
                <path stroke-linecap="round" stroke-linejoin="round" d="M2.25 2.25h1.386c.51 0 .958.34 1.09.832l.383 1.436m0 0L6.75 14.25h10.5l2.25-7.5H6.75m-1.641-4.732L6.75 14.25m0 0a2.25 2.25 0 100 4.5 2.25 2.25 0 000-4.5zm10.5 0a2.25 2.25 0 100 4.5 2.25 2.25 0 000-4.5z" />
              </svg>
              <%= turbo_frame_tag "cartsize" do %>
                <%= render "carts/cart_item_count" %>
              <% end %>
            <% end %>
          </div>

          <!-- Add Product -->
          <%= link_to new_product_path, class: "inline-flex items-center px-2 py-1 rounded-md bg-stone-600 text-white hover:bg-stone-700" do %>
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-5 h-5">
              <path stroke-linecap="round" stroke-linejoin="round" d="M12 4.5v15m7.5-7.5h-15" />
            </svg>
          <% end %>

          <!-- Sign out -->
          <%= link_to "Sign out", destroy_user_session_path, 
            data: { turbo_method: :delete }, 
            class: "text-sm text-gray-600 hover:text-red-600" %>
        <% else %>
          <%= link_to "Sign up", new_user_registration_path, class: "text-sm text-primary hover:text-dark" %>
          <%= link_to "Sign in", new_user_session_path, class: "text-sm text-primary hover:text-dark" %>
        <% end %>
      </div>
    </div>
  </div>

  <!-- Toggle -->
  <div class="lg:hidden hidden px-2 pt-3 pb-4" data-toggle-target="menu">
    <div class="flex items-center justify-between space-x-4">
      <% if user_signed_in? %>
        <!-- User Photo -->
        <%= render partial: "shared/user_photo", locals: { user: current_user } %>

        <!-- Cart with count -->
        <div class="relative">
          <%= link_to cart_path, class:"relative" do %>
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 20 20" stroke-width="1.5" stroke="currentColor" class="w-6 text-primary">
              <path stroke-linecap="round" stroke-linejoin="round" d="M2.25 2.25h1.386c.51 0 .958.34 1.09.832l.383 1.436m0 0L6.75 14.25h10.5l2.25-7.5H6.75m-1.641-4.732L6.75 14.25m0 0a2.25 2.25 0 100 4.5 2.25 2.25 0 000-4.5zm10.5 0a2.25 2.25 0 100 4.5 2.25 2.25 0 000-4.5z" />
            </svg>
            <%= turbo_frame_tag "cartsize" do %>
              <%= render "carts/cart_item_count" %>
            <% end %>
          <% end %>
        </div>

        <!-- Add Product -->
        <%= link_to new_product_path, class: "inline-flex items-center px-2 py-1 rounded-md bg-stone-600 text-white hover:bg-stone-700" do %>
          <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-5 h-5">
            <path stroke-linecap="round" stroke-linejoin="round" d="M12 4.5v15m7.5-7.5h-15" />
          </svg>
        <% end %>

        <!-- Sign out -->
        <%= link_to "Sign out", destroy_user_session_path, 
          data: { turbo_method: :delete }, 
          class: "text-sm text-gray-600 hover:text-red-600" %>
      <% else %>
        <%= link_to "Sign up", new_user_registration_path, class: "text-sm text-primary hover:text-dark" %>
        <%= link_to "Sign in", new_user_session_path, class: "text-sm text-primary hover:text-dark" %>
      <% end %>
    </div>
  </div>
</nav>
